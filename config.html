<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>XYZObywatel v2.0 – konfigurator</title>
  <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no, viewport-fit=cover">
  <meta name="format-detection" content="telephone=no">

  <link rel="icon" type="image/png" href="assets/icons/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">

  <link rel="manifest" href="assets/manifest.json">
  <meta name="theme-color" content="#0b1220">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
body{margin:0;font-family:system-ui;background:radial-gradient(circle at top,#1b1f3b,#05060f);color:#fff}
.container{max-width:420px;margin:auto;padding:16px}
h1{text-align:center;margin:16px 0;font-weight:600}
.card{background:rgba(255,255,255,.05);border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:0 0 25px rgba(140,100,255,.25)}
label{font-size:12px;opacity:.8}
input,select{width:100%;margin:6px 0 12px;padding:12px;border-radius:12px;border:none;background:rgba(0,0,0,.4);color:#fff;font-size:14px}
button{width:100%;padding:14px;border-radius:14px;border:none;background:linear-gradient(135deg,#8b5cf6,#6366f1);color:#fff;font-size:16px;font-weight:600}
.warning{text-align:center;font-size:11px;opacity:.5;margin-top:12px}
</style>
  <script defer src="assets/pwa.js"></script>
</head>

<body>

<div class="container" id="form">
<h1>konfigurator Mobywatel</h1>

<div class="card">
<label>Imię</label><input id="imie">
<label>Nazwisko</label><input id="nazwisko">
<label>Płeć</label>
<select id="plec"><option>MĘŻCZYZNA</option><option>KOBIETA</option></select>
<label>Data urodzenia</label><input type="date" id="dataUrodzenia">
<label>PESEL</label><input id="pesel" readonly>
<label>Seria i numer mDowodu</label><input id="seria" placeholder="np. MWYC 24561">
<label>Data wydania</label><input id="wydanie" value="14.07.2023" readonly>
<label>Termin ważności</label><input id="waznosc" value="14.07.2028" readonly>
</div>

<div class="card">
<label>Imię ojca</label><input id="ojciec">
<label>Imię matki</label><input id="matka">
<label>Obywatelstwo</label><input id="obywatelstwo" value="POLSKIE">
<label>Miejsce urodzenia</label><input id="miejsce">
<label>Kraj urodzenia</label><input id="kraj" value="Polska">
</div>

<div class="card">
<label>Ulica i numer</label><input id="ulica">
<label>Kod pocztowy</label><input id="kod">
<label>Miasto</label><input id="miasto">
<label>Data zameldowania</label><input type="date" id="zameldowanie">
</div>

<div class="card">
<label>Nazwisko rodowe (Twoje)</label><input id="rodowe">
<label>Nazwisko rodowe ojca</label><input id="rodoweOjca">
<label>Nazwisko rodowe matki</label><input id="rodoweMatki">
</div>

<div class="card">
<label>Zdjęcie</label><input type="file" id="photo" accept="image/*">
</div>

<div class="card" id="accessGate">
  <label>Kod dostępu</label>
  <input id="accessCode" placeholder="Wpisz kod">
  <div id="codeErr" style="display:none;color:#f87171;font-size:12px;">Niepoprawny kod</div>
</div>


<button onclick="generate()">GENERUJ</button>
<div class="warning">WERSJA EKSPERYMENTALNA / DEMO</div>
</div>

<script>
function generateDemoPESEL(dateStr, male=true){
  if(!dateStr) return "";

  // dateStr = "YYYY-MM-DD" (bez użycia new Date() – iOS safe)
  const parts = dateStr.split("-");
  if(parts.length !== 3) return "";
  const Y = Number(parts[0]);
  const M = Number(parts[1]);
  const D = Number(parts[2]);
  if(!Y || !M || !D) return "";

  const y = Y % 100;
  const m = M;
  const base =
    String(y).padStart(2,'0') +
    String(m).padStart(2,'0') +
    String(D).padStart(2,'0');

  const rand = Math.floor(1000 + Math.random() * 9000);
  return base + rand + (male ? 1 : 0);
}
function toPLDate(dateStr){ // "YYYY-MM-DD" -> "DD.MM.RRRR"
  if(!dateStr) return "";
  const [y, m, d] = dateStr.split("-");
  return `${d}.${m}.${y}`;
}

// Podpinamy eventy po załadowaniu DOM (pewniejsze)
window.addEventListener("DOMContentLoaded", () => {
  const dataUrodzeniaEl = document.getElementById("dataUrodzenia");
  const plecEl = document.getElementById("plec");
  const peselEl = document.getElementById("pesel");

  if (dataUrodzeniaEl && plecEl && peselEl) {
    dataUrodzeniaEl.addEventListener("change", () => {
      peselEl.value = generateDemoPESEL(
        dataUrodzeniaEl.value,
        plecEl.value === "MĘŻCZYZNA"
      );
    });
  }
});

function generate(){
  const code = document.getElementById("accessCode").value.trim();
  const err = document.getElementById("codeErr");

  if (!REQUIRED_CODES.includes(code)) {
    err.style.display = "block";
    return; // STOP
  }
  err.style.display = "none";

  const data = {
    imie: document.getElementById("imie").value,
    nazwisko: document.getElementById("nazwisko").value,
    plec: document.getElementById("plec").value,
    data: toPLDate(document.getElementById("dataUrodzenia").value),
    pesel: document.getElementById("pesel").value,
    seria: document.getElementById("seria").value,
    wydanie: document.getElementById("wydanie").value,
    waznosc: document.getElementById("waznosc").value,
    ojciec: document.getElementById("ojciec").value,
    matka: document.getElementById("matka").value,
    obywatelstwo: document.getElementById("obywatelstwo").value,
    miejsce: document.getElementById("miejsce").value,
    kraj: document.getElementById("kraj").value,
    ulica: document.getElementById("ulica").value,
    kod: document.getElementById("kod").value,
    miasto: document.getElementById("miasto").value,
    zameldowanie: document.getElementById("zameldowanie").value,
    rodowe: document.getElementById("rodowe").value,
    rodoweOjca: document.getElementById("rodoweOjca").value,
    rodoweMatki: document.getElementById("rodoweMatki").value,
    photo: null
  };

  const f = document.getElementById("photo")?.files?.[0];
  if (f) {
    const r = new FileReader();
    r.onload = () => {
      data.photo = r.result;
      localStorage.setItem("mobywatel_user", JSON.stringify(data));
      location.href = "/card.html";
    };
    r.readAsDataURL(f);
  } else {
    localStorage.setItem("mobywatel_user", JSON.stringify(data));
    location.href = "/card.html";
  }
}

</script>
<script>
const REQUIRED_CODES = [
  "A7F9K2M8Q",
  "K7M9A2QF8",
  "Z4P8N6A9M",
  "Q2F7K9M8A",
  "8A9KQ7M2F",
  "M9QF2K7A8",
  "A8K9F7Q2M",
  "P7M9A8KQ2",
  "Q9A2K8M7F",
  "K8Q2M9F7A",
  "A9M7Q8K2F"
];

window.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("accessCode");
  const err = document.getElementById("codeErr");


  const btn = document.querySelector("button");

  if (!input || !btn) return;

  
  btn.disabled = true;
  btn.style.opacity = "0.5";

  function validate(){
   const ok = REQUIRED_CODES.includes(input.value.trim());
    btn.disabled = !ok;
    btn.style.opacity = ok ? "1" : "0.5";
    err.style.display = (!ok && input.value.trim().length) ? "block" : "none";
  }

  input.addEventListener("input", validate);
});
</script>


</body>
</html>
