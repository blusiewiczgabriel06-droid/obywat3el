<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>XYZObywatel v2.0 – konfigurator</title>
  <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no, viewport-fit=cover">
  <meta name="format-detection" content="telephone=no">

  <link rel="icon" type="image/png" href="assets/icons/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">

  <link rel="manifest" href="assets/manifest.json">
  <meta name="theme-color" content="#0b1220">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
body{margin:0;font-family:system-ui;background:radial-gradient(circle at top,#1b1f3b,#05060f);color:#fff}
.container{max-width:420px;margin:auto;padding:16px}
h1{text-align:center;margin:16px 0;font-weight:600}
.card{background:rgba(255,255,255,.05);border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:0 0 25px rgba(140,100,255,.25)}
label{font-size:12px;opacity:.8}
input,select{width:100%;margin:6px 0 12px;padding:12px;border-radius:12px;border:none;background:rgba(0,0,0,.4);color:#fff;font-size:14px}
button{width:100%;padding:14px;border-radius:14px;border:none;background:linear-gradient(135deg,#8b5cf6,#6366f1);color:#fff;font-size:16px;font-weight:600}
.warning{text-align:center;font-size:11px;opacity:.5;margin-top:12px}
</style>
  <script defer src="assets/pwa.js"></script>
</head>

<body>

<div class="container" id="form">
<h1>konfigurator Mobywatel</h1>

<div class="card">
<label>Imię</label><input id="imie">
<label>Nazwisko</label><input id="nazwisko">
<label>Płeć</label>
<select id="plec"><option>MĘŻCZYZNA</option><option>KOBIETA</option></select>
<label>Data urodzenia</label><input type="date" id="dataUrodzenia">
<label>PESEL</label><input id="pesel" readonly>
<label>Seria i numer mDowodu</label><input id="seria" placeholder="np. MWYC 24561">
<label>Data wydania</label><input id="wydanie" value="14.07.2023" readonly>
<label>Termin ważności</label><input id="waznosc" value="14.07.2028" readonly>
</div>

<div class="card">
<label>Imię ojca</label><input id="ojciec">
<label>Imię matki</label><input id="matka">
<label>Obywatelstwo</label><input id="obywatelstwo" value="POLSKIE">
<label>Miejsce urodzenia</label><input id="miejsce">
<label>Kraj urodzenia</label><input id="kraj" value="Polska">
</div>

<div class="card">
<label>Ulica i numer</label><input id="ulica">
<label>Kod pocztowy</label><input id="kod">
<label>Miasto</label><input id="miasto">
<label>Data zameldowania</label><input type="date" id="zameldowanie">
</div>

<div class="card">
<label>Nazwisko rodowe (Twoje)</label><input id="rodowe">
<label>Nazwisko rodowe ojca</label><input id="rodoweOjca">
<label>Nazwisko rodowe matki</label><input id="rodoweMatki">
</div>

<div class="card">
<label>Zdjęcie</label><input type="file" id="photo" accept="image/*">
</div>



<button id="genBtn" type="button">GENERUJ</button>

<div class="warning">WERSJA EKSPERYMENTALNA / DEMO</div>
</div>

<script>
// ===== PESEL (iOS-safe) =====
function generateDemoPESEL(dateStr, male=true){
  if(!dateStr) return "";
  const [Y,M,D] = dateStr.split("-").map(Number);
  if(!Y || !M || !D) return "";
  const base =
    String(Y%100).padStart(2,"0") +
    String(M).padStart(2,"0") +
    String(D).padStart(2,"0");
  const rand = Math.floor(1000 + Math.random() * 9000);
  return base + rand + (male ? 1 : 0);
}

function toPLDate(dateStr){
  if(!dateStr) return "";
  const [y,m,d] = dateStr.split("-");
  return `${d}.${m}.${y}`;
}

window.addEventListener("DOMContentLoaded", () => {
  const d = document.getElementById("dataUrodzenia");
  const p = document.getElementById("plec");
  const pe = document.getElementById("pesel");

  if(d && p && pe){
    d.addEventListener("change", () => {
      pe.value = generateDemoPESEL(d.value, p.value === "MĘŻCZYZNA");
    });
  }

  document.getElementById("genBtn").addEventListener("click", () => {
    const v = id => document.getElementById(id)?.value ?? "";

    const data = {
      imie: v("imie"),
      nazwisko: v("nazwisko"),
      plec: v("plec"),
      data: toPLDate(v("dataUrodzenia")),
      pesel: v("pesel"),
      seria: v("seria"),
      wydanie: v("wydanie"),
      waznosc: v("waznosc"),
      ojciec: v("ojciec"),
      matka: v("matka"),
      obywatelstwo: v("obywatelstwo"),
      miejsce: v("miejsce"),
      kraj: v("kraj"),
      ulica: v("ulica"),
      kod: v("kod"),
      miasto: v("miasto"),
      zameldowanie: v("zameldowanie"),
      rodowe: v("rodowe"),
      rodoweOjca: v("rodoweOjca"),
      rodoweMatki: v("rodoweMatki"),
      photo: null
    };

    // zapis pod kartę (format assets/card.js)
    const profile = {
      name: data.imie,
      surname: data.nazwisko,
      nationality: data.obywatelstwo,
      birthday: data.data,
      pesel: data.pesel,
      sex: data.plec === "MĘŻCZYZNA" ? "m" : "k",
      mdow_series: data.seria,
      expiry_date: data.waznosc,
      issue_date: data.wydanie,
      father_name: data.ojciec,
      mother_name: data.matka,
      familyName: data.rodowe,
      fathersFamilyName: data.rodoweOjca,
      mothersFamilyName: data.rodoweMatki,
      birthPlace: data.miejsce,
      countryOfBirth: data.kraj,
      adress: `${data.ulica}, ${data.kod} ${data.miasto}`
    };

    const f = document.getElementById("photo")?.files?.[0];
    const finish = () => {
      localStorage.setItem("mobywatel_user", JSON.stringify(data));
      localStorage.setItem("mobywatel_profile_v1", JSON.stringify(profile));
      location.href = "/card.html";
    };

    if(f){
      const r = new FileReader();
      r.onload = () => { data.photo = r.result; finish(); };
      r.readAsDataURL(f);
    } else {
      finish();
    }
  });
});
</script>



</body>
</html>
