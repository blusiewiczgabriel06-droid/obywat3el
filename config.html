<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>XYZObywatel v2.0 â€“ konfigurator</title>
  <meta name="viewport" content="width=device-width, initial-scale=0.8, user-scalable=no, viewport-fit=cover">
  <meta name="format-detection" content="telephone=no">

  <link rel="icon" type="image/png" href="assets/icons/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">

  <link rel="manifest" href="assets/manifest.json">
  <meta name="theme-color" content="#0b1220">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
body{margin:0;font-family:system-ui;background:radial-gradient(circle at top,#1b1f3b,#05060f);color:#fff}
.container{max-width:420px;margin:auto;padding:16px}
h1{text-align:center;margin:16px 0;font-weight:600}
.card{background:rgba(255,255,255,.05);border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:0 0 25px rgba(140,100,255,.25)}
label{font-size:12px;opacity:.8}
input,select{width:100%;margin:6px 0 12px;padding:12px;border-radius:12px;border:none;background:rgba(0,0,0,.4);color:#fff;font-size:14px}
button{width:100%;padding:14px;border-radius:14px;border:none;background:linear-gradient(135deg,#8b5cf6,#6366f1);color:#fff;font-size:16px;font-weight:600}
.warning{text-align:center;font-size:11px;opacity:.5;margin-top:12px}
</style>
  <script defer src="assets/pwa.js"></script>
</head>

<body>

<div class="container" id="form">
<h1>konfigurator Mobywatel</h1>

<div class="card">
<label>ImiÄ™</label><input id="imie">
<label>Nazwisko</label><input id="nazwisko">
<label>PÅ‚eÄ‡</label>
<select id="plec"><option>MÄ˜Å»CZYZNA</option><option>KOBIETA</option></select>
<label>Data urodzenia</label><input type="date" id="dataUrodzenia">
<label>PESEL</label><input id="pesel" readonly>
<label>Seria i numer mDowodu</label><input id="seria" placeholder="np. MWYC 24561">
<label>Data wydania</label><input id="wydanie" value="14.07.2023" readonly>
<label>Termin waÅ¼noÅ›ci</label><input id="waznosc" value="14.07.2028" readonly>
</div>

<div class="card">
<label>ImiÄ™ ojca</label><input id="ojciec">
<label>ImiÄ™ matki</label><input id="matka">
<label>Obywatelstwo</label><input id="obywatelstwo" value="POLSKIE">
<label>Miejsce urodzenia</label><input id="miejsce">
<label>Kraj urodzenia</label><input id="kraj" value="Polska">
</div>

<div class="card">
<label>Ulica i numer</label><input id="ulica">
<label>Kod pocztowy</label><input id="kod">
<label>Miasto</label><input id="miasto">
<label>Data zameldowania</label><input type="date" id="zameldowanie">
</div>

<div class="card">
<label>Nazwisko rodowe (Twoje)</label><input id="rodowe">
<label>Nazwisko rodowe ojca</label><input id="rodoweOjca">
<label>Nazwisko rodowe matki</label><input id="rodoweMatki">
</div>

<div class="card">
<label>ZdjÄ™cie</label><input type="file" id="photo" accept="image/*">
</div>

<button onclick="generate()">GENERUJ</button>
<div class="warning">WERSJA EKSPERYMENTALNA / DEMO</div>
</div>

<script>
function generateDemoPESEL(dateStr, male=true){
  if(!dateStr) return "";

  // dateStr = "YYYY-MM-DD" (bez uÅ¼ycia new Date() â€“ iOS safe)
  const parts = dateStr.split("-");
  if(parts.length !== 3) return "";
  const Y = Number(parts[0]);
  const M = Number(parts[1]);
  const D = Number(parts[2]);
  if(!Y || !M || !D) return "";

  const y = Y % 100;
  const m = M;
  const base =
    String(y).padStart(2,'0') +
    String(m).padStart(2,'0') +
    String(D).padStart(2,'0');

  const rand = Math.floor(1000 + Math.random() * 9000);
  return base + rand + (male ? 1 : 0);
}
function toPLDate(dateStr){ // "YYYY-MM-DD" -> "DD.MM.RRRR"
  if(!dateStr) return "";
  const [y, m, d] = dateStr.split("-");
  return `${d}.${m}.${y}`;
}

// Podpinamy eventy po zaÅ‚adowaniu DOM (pewniejsze)
window.addEventListener("DOMContentLoaded", () => {
  const dataUrodzeniaEl = document.getElementById("dataUrodzenia");
  const plecEl = document.getElementById("plec");
  const peselEl = document.getElementById("pesel");

  if (dataUrodzeniaEl && plecEl && peselEl) {
    dataUrodzeniaEl.addEventListener("change", () => {
      peselEl.value = generateDemoPESEL(
        dataUrodzeniaEl.value,
        plecEl.value === "MÄ˜Å»CZYZNA"
      );
    });
  }
});

function generate(){
  const data = {
    imie: imie.value,
    nazwisko: nazwisko.value,
    plec: plec.value,
    data: toPLDate(dataUrodzenia.value), // ðŸ‘ˆ TU JEST ZMIANA
    pesel: pesel.value,
    seria: seria.value,
    wydanie: wydanie.value,
    waznosc: waznosc.value,
    ojciec: ojciec.value,
    matka: matka.value,
    obywatelstwo: obywatelstwo.value,
    miejsce: miejsce.value,
    kraj: kraj.value,
    ulica: ulica.value,
    kod: kod.value,
    miasto: miasto.value,
    zameldowanie: zameldowanie.value,
    rodowe: rodowe.value,
    rodoweOjca: rodoweOjca.value,
    rodoweMatki: rodoweMatki.value,
    photo: null
  };
  
  const f = photo?.files?.[0];
  if (f) {
    const r = new FileReader();
    r.onload = () => {
      data.photo = r.result;
      localStorage.setItem("mobywatel_user", JSON.stringify(data));
      location.href = "./card.html";
    };
    r.readAsDataURL(f);
  } else {
    localStorage.setItem("mobywatel_user", JSON.stringify(data));
    location.href = "./card.html";
  }
}
</script>

</body>
</html>
